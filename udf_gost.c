#include <string.h>
#include <stdlib.h>
#include <stdio.h>
#include <my_global.h>
#include <my_sys.h>
#include <mysql.h>
#include <ctype.h>
#include "gost_f.h"



char * gost512(UDF_INIT *initid, UDF_ARGS *args, char *result, unsigned long *length, char *is_null, char *error)
{	
	char *M = args->args[0];
	unsigned char *h;
	long long M_length=strlen(M)*8;
	
	unsigned char IV[64] =
	{
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
		
	};

	h = calc_hash(M,M_length,IV);
	*length=128;
	
	unsigned char hex_str[]= "0123456789abcdef";
	for(int i=0;i<64;i++)
	{
		result[i*2+0]=hex_str[(h[i] >> 4) & 0x0F];
		result[i*2+1]=hex_str[(h[i] ) & 0x0F];
	}
	
	return result;
}


my_bool gost512_init (UDF_INIT *initid, UDF_ARGS *args, char *message)
{
	if(args->arg_count != 1)
	{
		strcpy(message, "hello requires exactly one string argument");
		return 1;
	}
	if(args->arg_type[0] != STRING_RESULT)
	{
		strcpy(message, "hello requires exactly one string argument");
		return 1;
	}

	
	return 0; /* true */
}

void gost512_deinit (UDF_INIT *initid)
{
	;
}


char * gost256(UDF_INIT *initid, UDF_ARGS *args, char *result, unsigned long *length, char *is_null, char *error)
{	
 	char *M = args->args[0];
	unsigned char *h;
	
	long long M_length=strlen(M)*8;
	

	unsigned char IV[64] = 
	{
		0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
		0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
		0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
		0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01
	};

	h = calc_hash(M,M_length,IV);
	*length=64;
	unsigned char hex_str[]= "0123456789abcdef";
	for(int i=0;i<32;i++)
	{
		result[i*2+0]=hex_str[(h[i] >> 4) & 0x0F];
		result[i*2+1]=hex_str[(h[i] ) & 0x0F];
	}
	
	return result;
}



my_bool gost256_init (UDF_INIT *initid, UDF_ARGS *args, char *message)
{
	if(args->arg_count != 1)
	{
		strcpy(message, "hello requires exactly one string argument");
		return 1;
	}
	if(args->arg_type[0] != STRING_RESULT)
	{
		strcpy(message, "hello requires exactly one string argument");
		return 1;
	}

	
	return 0; /* true */
}

void gost256_deinit (UDF_INIT *initid)
{
	;
}

